# GF_MUL_GILES_DIS_ASM

This file is related to the **Galois field multiplication based on Log_Exp: GF(2^8)**
c = a * b, where a, b and c are one share.
The function gfmul is used in all gadget for computing a[i] * b[i].\
**mul.S** is the implementation of GF(2^8) (gfmul(a,b,c), c = a * b)
for ARM Cortex-M0/3 in GNU assembly, 
with THUMB-16 instructions. The multiplication 
is based on Log_Ex with table.

# Generating traces for T_test for gf_multiplication
Download [sumb-sim](https://github.com/sca-research/thumb-sim)

Copy the **GF_MUL** file in **thumb-sim**\
From **thumb-sim/GF_MUL** directory, Via terminal run `./t_test_one_gfmul.sh`.\
Note: If after running  `./t_test_one_gfmul.sh` in terminal,
you receive **Permission denied**,
 for solving: `chmod +x ./t_test_one_gfmul.sh`, 
and then for running: `./t_test_one_gfmul.sh`.

There are 4 arguments for `./t_test_one_gfmul.sh` command:
1) The file included the codes (.c, .S, ...)
2) The name of the file that you want to save fixed traces in. 
3) The name of the file that you want to save random traces in.
4) The number of traces for each fixed and random traces.\
`./t_test_one_gfmul.sh gfmul fix rnd 1000`.\
By default: If you just run `./t_test_one_gfmul.sh`, your fixed traces are inside **fix_traces.trs**, random traces are inside **rnd_traces.trs**, and each file contains 1000 traces.  


This means:
1) At the first, it compiles THUMB_SIM.
Go to the **gfmul** file (thumb-sim/GF_MUL/gfmul)
2) Compiles the gfmul for fix data (make f_vs_r=1 -C  GF_MUL/gfmul), then generating fix traces by using GILES.
3) copies **fix_traces.trs** in **T_test_GFMUL_python** file (thumb-sim/GF_MUL/T_test_GFMUL_python).
4) Compiles the gfmul for random data (make f_vs_r=0 -C  GF_MUL/gfmul), then generating random traces by using GILES.
5) copies **rnd_traces.trs** in **T_test_GFMUL_python** file (thumb-sim/GF_MUL/T_test_GFMUL_python).   

After running `./t_test_one_gfmul.sh`, in **T_test_GFMUL_python** file, the two **.trs** file must be there.

# Python, Analysis, T_test, leaky instruction
**Analysis.py**: For checking the correctness of **.trs** files.
**T_test.py**, for performing the T_TEST on **fix_traces.trs** and **rnd_traces.trs**\\
In **T_test.py** if you want to find the leaky instructions, you need
both file **disassemble.txt** and **GILES_disassemble.txt**.\
\
**GILES_disassemble.txt** is generated by GILES in **gfmul** file.\
\
**disassemble.txt** file is generated in **T_test.py** (the **GILES_disassemble.txt** is needed).
And contains the leaky instructions.
Generating **GILES_disassemble.txt**:
For generating **GILES_disassemble.txt**, you need to
add some instructions to GILES, and then compile the GILES:\

```
$ git clone --recurse-submodules https://github.com/bristol-sca/GILES
```
GILES/src/Execution.hpp

add:
```
#include <fstream>
#include <iomanip>      // std::setfill, std::setw
```
Inside function **Get_Instruction**, after 
```
        // Get the instruction as a string
        std::string instruction =
            Get_Value<std::string>(p_cycle, p_pipeline_stage_name);
```
Add:             
```
        std::ofstream writer("GILES_disassemble.txt", std::ios::app);
        if (!writer){
            std::cout << " Error opening file" << std::endl;
        }
        else{
            writer << std::setw(4) << std::setfill('0') << p_cycle+1 << ": " << instruction << std::endl;
            writer.close();
        }
```
Then, 
# Compiling GILES
Copy **compiling_GILES.sh** to **GILES** file and run `./compiling_GILES.sh`.

Now, if you run `./t_test_one_gfmul.sh` through the related directory (GF_MUL), 
the **GILES_disassemble.txt** is generated by GILES in **gfmul** file.

















